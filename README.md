# TeraTerm_AutoLogin
【TeraTerm】ホストを選択して自動ログインするマクロ

### 動作環境

* Tera Termが動くWindows OS。
* Tera Term Version 4.92 以降で動作します。(それ以前のバージョンは動作保証外です。)

### ファイルの説明

|ファイル名|説明|
|:---|:---|
|AutoLogin.ttl|マクロ本体です。Tera Termの`ttpmacro.exe`と関連付けることで直接動作します。<br>テキストエディタで開き、冒頭のカスタム設定を編集することで、様々な設定を変更できます。|
|hosts.list|接続したいホストの自動ログインに必要な情報を記述するファイルです。<br>また、ホスト毎にグループ分けをすることが出来ます。|
|Group1.vbs|マクロ本体を`ttpmacro.exe`と関連付けなくてもマクロを実行することができるVBScriptファイルです。<br>(ファイル名は任意の名前に変更したり、ファイルを複製して利用可能)<br>`hosts.list`内で設定したグループをこのファイル内で指定することで、指定したグループのホストだけを接続対象ホストとして一覧表示できたり、ログの保存先を変えたりする機能があります。<br>利用形態に応じて複数のホスト群ごとに設定を使い分けたい場合、このファイルを複製し、ファイル名や設定を書き換えて利用します。|
|command.list|ホストにログイン後、自動で実行したいコマンドを記述するファイルです。<br>対話型のコマンドには対応しませんが、べた書きでコマンドを記述できます。|

### 特徴

**自動ログイン**

* リストボックス形式のウインドウから接続ホストを選択して、IPアドレスや認証方式、ポート番号やパスワードの入力をすることなく自動ログインできます。
* Telnetのパスワード認証による自動ログインに対応しています。
* SSHの自動ログインはパスワード認証、公開鍵認証、チャレンジレスポンス認証に対応しています。
* 自動ログインに関する情報はすべてのサーバーの情報を`hosts.list`ファイルにまとめて記述することができます。
いちいち接続対象ごとにマクロを複製して接続情報を書き換えたりする必要がありません。
* ログインパスワードは初回ログイン時のみ入力が必要ですが、パスワード情報が暗号化してパスワードファイルに保存されます。次回以降はパスワードの入力無しにログインが出来るようになります。
* `hosts.list`ファイル内で、接続ホスト毎にグループ分けすることができ、添付の`Group1.vbs`からグループを指定することで、グループ名が一致するホストだけをリストボックスに表示することができます。

**操作ログの自動取得について**
* Tera Termの操作ログを自動で取得することができます。
* ログの名前や保存先フォルダの名前は[strftime](https://linuxjm.osdn.jp/html/LDP_man-pages/man3/strftime.3.html)形式のフォーマットを利用できます。
フォルダ名やファイル名に現在の日時を含めたい場合に便利です。<br>
※接続ホストの名称は[strftime](https://linuxjm.osdn.jp/html/LDP_man-pages/man3/strftime.3.html)形式では指定できないため、接続ホスト名をログの名前やフォルダ名に使いたい場合、`$HOSTNAME`という文字列を接続ホスト名に置換する作りにしてあります。
* 保存先のフォルダは階層で指定することができ、フォルダはログ取得時に自動で作成されます。
* 必要に応じてログにタイムスタンプを書き込むことができます。<br>
※ `Group1.vbs`からマクロを実行する場合のみ。

**コマンドの自動実行**
* `command.list`にホスト上で実行したいコマンドを直接記述しておくことで、ログイン後自動でコマンドを実行することができます。
* Tera Termマクロの中にコマンドを直接書き込むやり方だと、マクロの構文を熟知する必要があり、非常に煩雑になってしまうために汎用性がありませんが、この方法を利用することで直感的にコマンドを記述できます。

**ファイルのパス指定**<br>
マクロで利用するそれぞれのファイル類は自由にファイル名や配置先を変更することができ、相対パス、絶対パス、およびUNCパスでの記述が可能です。<br>
ファイルパス指定で環境依存性の問題が極力起きにくい作りにしてあります。

### インストール
**Tera Termのインストール**<br>
Version 4.92でサポートされたマクロの機能を利用しているため、それ以降のバージョンが必須です。<br>
Tera Termのバージョンは出来るだけ新しいものを利用するのを推奨します。

**マクロの配置**<br>
`Autologin`フォルダごと、適当な場所に配置してください。

### マクロの実行方法
1. hosts.listにホストの接続情報を記述します。
2. 以下の方法のいずれかでマクロを実行します。
    * TTLの拡張子に`ttpmacro.exe`を関連付けて実行する。
    * Tera Termのメニューから、[コントロール] - [マクロ]を選択し、ファイル選択ダイアログで`AutoLogin.ttl`ファイルを選択する。
    * `ttpmacro.exe`を直接起動し、ファイル選択ダイアログで`AutoLogin.ttl`ファイルを選択する。
    * `Group1.vbs`を実行し、マクロを実行する。<br>※ファイル内の`TTPMACROPATH`オプションと`TTLFILEPATH`オプションで、`ttpmacro.exe`と`AutoLogin.ttl`の正しいパスが記述されている必要があります。

### ファイルの詳細、オプションの説明
**AutoLogin.ttl**<br>
テキストエディタで開き、冒頭の「カスタム設定」にて各種項目の値を編集することで、利用したい環境に応じて設定を変えることができます。<br>
それぞれの項目のパスの指定は相対パス、絶対パス、UNCパスが利用できます。<br>
パスの指定で相対パスを利用する場合、すべて`AutoLogin.ttl`を起点にして記述します。

|オプションの名称|説明|
|:---|:---|
|HOST_FILE|`hosts.list`のファイル名や配置先を変更したい場合に編集します。|
|LOG_DIR_PATH|Tera Termの操作ログを保存するフォルダのパスを指定します。<br>フォルダが無い場合、サブフォルダを含め、再帰的にフォルダが作成されます。<br>[strftime](https://linuxjm.osdn.jp/html/LDP_man-pages/man3/strftime.3.html)形式のフォーマットでファイル名を指定します。<br>`$HOSTNAME`という文字列で、接続ホスト名に文字が置き換わります。<br>`Group1.vbs`からマクロを実行する場合は、`AutoLogin.ttl`の設定より`Group1.vbs`の設定が優先して利用されます。<br>空白 `""` を指定した場合はログの自動取得を実行しません。|
|LOG_FILENAME|[strftime](https://linuxjm.osdn.jp/html/LDP_man-pages/man3/strftime.3.html)形式のフォーマットで操作ログのファイル名を指定します。<br>`$HOSTNAME`という文字列で、接続ホスト名に文字が置き換わります。|
|INI_DIR_PATH |`hosts.list`でホスト毎の`TERATERM.INI`のパスを相対パスで指定する場合、起点となるディレクトリを指定します。|
|PASSWDFILE_DIR_PATH|自動ログインに利用するパスワード情報を記録したファイルの保存先ディレクトリを指定します。<br>指定したフォルダが無い場合は、パスワードファイル作成時に自動で作成されます。<br>※誤ったパスワードを入力してホストにログインしようとした場合、次回以降も誤ったパスワード情報を利用してログインしようとするため、その場合は保存されたパスワードファイルを直接削除してください。|
|SSHKEY_DIR_PATH|公開鍵認証のSSH接続を利用する場合に、`hosts.list`で秘密鍵のパスを相対パスで指定する場合、起点となるディレクトリを指定します。|
|COMMAND_FILE|`command.list`のファイル名を含めたパスを記述します。<br>`Group1.vbs`からマクロを実行する場合は、`AutoLogin.ttl`の設定は機能せず、Group1.vbsの設定が利用されます。|
|DEFAULT_LOGIN_USER|`hosts.list`内で、ログインユーザの指定がない場合にログインを試みるユーザーを指定します。|
|ADJUST_DISPLAY_POSITION|Tera Termの端末ウインドウ初期位置を調整するかしないかを以下のいずれかの値で指定します。<br>「on」       : 端末ウインドウ初期位置を調整します。<br>「off」      : 端末ウインドウ初期位置を調整しません。<br>※値の指定に大文字、小文字の区別はありません。|
|DISPLAY_POSITION_X|`ADJUST_DISPLAY_POSITION`オプションが`on`の場合に、横の位置情報を数字で指定します。|
|DISPLAY_POSITION_Y|`ADJUST_DISPLAY_POSITION`オプションが`on`の場合に、縦の位置情報を数字で指定します。|

**hosts.list**<br>
カンマ(,)区切りでホストの接続情報を記述するものです。以下の項目を記述します。

|列&nbsp;&nbsp;|空白の許可|説明|
|:---|:---|:---|
|列1|いいえ|接続ホストの任意の名称を記述します。|
|列2|いいえ|ホストの接続に利用するIPアドレス、またはFQDN名を記述します。|
|列3|はい|`TERATERM.INI`のパスを`AutoLogin.ttl`からの相対パスか絶対パス、UNCパスのいずれかで記述します。<br>この機能を利用してホスト毎に別々の`TERATERM.INI`を指定することで設定を使い分けたり、ホスト毎に背景色を変えたりできます。<br>相対パスを記述する場合、`AutoLogin.ttl`内で指定してある`INI_DIR_PATH`が起点のディレクトリになります。<br>この項目を空白にした場合、`ttpmacro.exe`があるディレクトリにある`TERATERM.INI`を読み込みます。|
|列4|いいえ|利用するプロトコルを記述します。「Telnet」または「SSH」のいずれかで指定します。<br>※値の指定に大文字、小文字の区別はありません。|
|列5|はい|Telnet、またはSSHの接続に利用するTCPポート番号を指定します。<br>空白の場合、デフォルトのTCPポート番号を使用して接続します。(TelnetはTCP23番、SSHはTCP22番)|
|列6|はい|Telnet、またはSSHの接続に利用するログインユーザを指定します。<br>空白にした場合は、`AutoLogin.ttl`内で指定してある`DEFAULT_LOGIN_USER`の値がログインユーザとして使用されます。|
|列7|はい|SSH接続の認証方式を下記のいずれかで指定します。<br>Telnetを利用する場合や、SSH接続に通常のパスワード認証を利用する場合は空白にします。<br>「publickey_passphrase」  : パスフレーズ入力有りで公開鍵認証を利用する場合に記述します。<br> 「publickey_nopassphrase」  : パスフレーズ入力無しで公開鍵認証を利用する場合に記述します。<br> 「challengeresponse」  : チャレンジレスポンス認証を利用する場合に記述します。<br>※値の指定に大文字、小文字の区別はありません。|
|列8|はい|SSH接続に公開鍵認証を利用する場合、秘密鍵のパスを相対パスか絶対パスで記述します。<br>相対パスを記述する場合、`AutoLogin.ttl`内で指定してある`SSHKEY_DIR_PATH`が起点のディレクトリになります。|
|列9|はい|ホスト毎にグループを定義します。空白にした場合はどのグループにも所属しない扱いになります。<br>hosts.listで定義したグループを`Group1.vbs`内の`GROUP`オプションで指定してやることで、接続ホストの選択画面で、指定したグループのホストのみを表示することができます。<br>`AutoLogin.ttl`単体で実行する場合はこの項目の値は使用しません。|

**command.list**<br>
接続ホスト上でログイン後に自動で実行したいコマンドを記述します。<br>
Group1.vbs内で`COMMANDLIST`オプションにコマンドファイルのパスを記述することにより、接続ホストのグループ毎に別々のコマンドファイルを指定することができます。<br>
デフォルトで以下のコマンドが記述済みです。

    uname -n
    date
    id

**Group1.vbs**<br>
`AutoLogin.ttl`マクロを実行することができるVBScriptファイルです。<br>
`TTPMACROPATH`オプションは、64bit版WindowsのみTera Termの初期インストールパスで動作するよう値が記述されています。<br>
他の場合は動作しないので必要に応じて変えてください。<br>
パスの指定は相対パス、絶対パス、UNCパスが利用できます。<br>

|オプションの名称|説明|
|:---|:---|
|TTPMACROPATH|Tera Termの本体内にある`ttpmacro.exe`のパスを指定します。<br>(相対パスは`Group1.vbs`を起点にします。)|
|TTLFILEPATH|`AutoLogin.ttl`のパスを指定します。<br>(相対パスは`Group1.vbs`を起点にします。)|
|COMMANDLIST|`command.list`のファイル名を含めたパスを記述します。<br>(相対パスは`Group1.vbs`を起点にします。)<br>`Group1.vbs`からマクロを実行した場合、`AutoLogin.ttl`内の`COMMAND_FILE`オプションの設定は無視されます。<br>コマンドファイルの自動実行を行わない場合、空白`""`を指定します。|
|GROUP|hosts.listの列9で定義したグループに対応し、グループ名が一致するホストのみを接続ホストの選択画面で表示することができます。|
|LOG_AUTOSTART|操作ログの自動取得設定について、下記のいずれかで指定します。<br>「on」       : ログの自動取得を実行します。<br>「off」      : ログの自動取得を実行しません。<br>「select」   : マクロの起動前にダイアログが表示され、ログの自動取得を実行するかしないかを選択できます。<br>※値の指定に大文字、小文字の区別はありません。|
|LOG_TIMESTAMP|操作ログの自動取得を実行する場合、タイムスタンプを書き込むかどうかを指定できます。<br>「on」       : ログの行頭にタイムスタンプを書き込みます。<br>「off」      : ログの行頭にタイムスタンプを書き込みません。<br>※値の指定に大文字、小文字の区別はありません。|
|LOG_DIR_PATH|Tera Termの操作ログを保存するフォルダのパスを指定します。(相対パスは`AutoLogin.ttl`を起点にします。)<br>`AutoLogin.ttl`の同設定より`Group1.vbs`の設定が優先して利用されます。<br>フォルダが無い場合、サブフォルダを含め、再帰的にフォルダが作成されます。<br>[strftime](https://linuxjm.osdn.jp/html/LDP_man-pages/man3/strftime.3.html)形式のフォーマットでファイル名を指定します。<br>`$HOSTNAME`という文字列で、接続ホスト名に文字が置き換わります。|

### 注意事項
* 初回ログイン時に入力したパスワード情報は、誤ったパスワードを入力してもファイルに保持され、次回ログイン時にも利用されます。<br>
このような場合、お手数ですが、`PASSWDFILE_DIR_PATH`オプションで指定したパスに保存されているパスワードファイルを直接削除してください。
* パスワード認証で空パスワードを利用してホストにログインする場合、パスワード情報がファイルに保存されないため、パスワード入力を省略することはできません。
